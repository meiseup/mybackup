cd ../gcc-build/
for file in $(find gcc/config -name linux64.h -o -name linux.h -o -name sysv4.h); do  cp -uv $file{,.orig};  sed -i 's@/lib\(64\)\?\(32\)\?/ld@/tools&@g'  -e 's@/usr@/tools@g' $file.orig > $file;  echo '
#undef STANDARD_STARTFILE_PREFIX_1
#undef STANDARD_STARTFILE_PREFIX_2
#define STANDARD_STARTFILE_PREFIX_1 "/tools/lib/"
#define STANDARD_STARTFILE_PREFIX_2 ""' >> $file;   touch $file.orig; done
tar -vxf package/gcc-4.9.2.tar.bz2 
sed -i '/k prot/agcc_cv_libc_provides_ssp=yes' gcc/configure 
../gcc-4.9.2/configure --target=$LFS_TGT --prefix=/tools --with-sysroot=$LFS --with-newlib --without-headers --with-local-prefix=/tools --with-native-system-header-dir=/tools/include --disable-nls --disable-shared --disable-multilib --disable-decimal-float --disable-threads --disable-libatomic --disable-libgomp --disable-libitm --disable-libquadmath --disable-libsanitizer --disable-libssp --disable-libvtv --disable-libcilkrts --disable-libstdc++-v3 --enable-languages=c,c++ 
../gcc-4.9.2/configure --target=$LFS_TGT --prefix=/tools --with-sysroot=$LFS --with-newlib --without-headers --with-local-prefix=/tools --with-native-system-header-dir=/tools/include --disable-nls --disable-shared --disable-multilib --disable-decimal-float --disable-threads --disable-libatomic --disable-libgomp --disable-libitm --disable-libquadmath --disable-libsanitizer --disable-libssp --disable-libvtv --disable-libcilkrts --disable-libstdc++-v3 --enable-languages=c,c++ --disable-werror
../gcc-4.9.2/configure --target=$LFS_TGT --prefix=/tools --with-sysroot=$LFS --with-newlib --without-headers --with-local-prefix=/tools --with-native-system-header-dir=/tools/include --disable-nls --disable-shared --disable-multilib --disable-decimal-float --disable-threads --disable-libatomic --disable-libgomp --disable-libitm --disable-libquadmath --disable-libsanitizer --disable-libssp --disable-libvtv --disable-libcilkrts --disable-libstdc++-v3 --enable-languages=c,c++ --disable-werror && make && make install 
tar -xf package/linux-3.19.tar.xz 
cd linux-3.19/
make mrproper 
make INSTALL_HDR_PATH=dest headers_install 
cp -rv dest/include/* /tools/include
tar -xf package/glibc-2.21.tar.xz 
cd glibc-2.21/
mkdir -v ../glibc-build
cd ../glibc-build/
../glibc-2.21/configure --prefix=/tools --host=$LFS_TGT --build=(../glibc-2.21/scripts/config.guess) \
../glibc-2.21/configure --prefix=/tools --host=$LFS_TGT --build=$(../glibc-2.21/scripts/config.guess) --disable-profile \
echo 'main(){}'>dummy.c
$LFS_TGT-gcc -v
$LFS_TGT-gcc -v dummy.c 
readelf -l a.out |grep ': /toools'
../gcc-4.9.2/libstdc++-v3/configure --host=$LFS_TGT --disable-multilib --disable-shared --disable-nls --disable-libstdcxx-threads --disable-libstdcxx-pch --with-gxx-include-dir=/tools/$LFS_TGT/include/c++/4.9.2 
../gcc-4.9.2/libstdc++-v3/configure --host=$LFS_TGT --disable-multilib --disable-shared --disable-nls --disable-libstdcxx-threads --disable-libstdcxx-pch --with-gxx-include-dir=/tools/$LFS_TGT/include/c++/4.9.2 --prefix=/tools 
tar -xf package/binutils-2.25.tar.bz2 
tar -xf package/gmp-6.0.0a.tar.xz -C binutils-2.25/
tar -xf package/isl-0.12.tar.bz2 -C binutils-2.25/
tar -xf package/cloog-0.18.0.tar.gz -C binutils-2.25/
mkdir ../binutils-build
cd ../binutils-build/
CC=$LFS_TGT-gcc AR=$LFS_TGT-ar RANLIB=$LFS_TGT-ranlib ../binutils-2.25/configure --prefix=/tools --disable-nls --disable-werror --with-lib-path=/tools/lib --with-sysroot
make -C ld clean
make -C ld LIB_PATH=/usr/lib:/lib
cp -v ld/ld-new /tools/bin
tar -xf package/gcc-4.9.2.tar.bz2 
tar -xf package/gmp-6.0.0a.tar.xz -C gcc-4.9.2/
tar -xf package/mpfr-3.1.2.tar.xz -C gcc-4.9.2/
tar -xf package/mpc-1.0.2.tar.gz -C gcc-4.9.2/
tar -xf package/isl-0.12.tar.bz2 -C gcc-4.9.2/
tar -xf package/cloog-0.18.0.tar.gz -C gcc-4.9.2/
cat gcc/limitx.h gcc/glimits.h gcc/limity.h > `dirname $($LFS_TGT-gcc -print-libgcc-file-name)`/include-fixed/limits T
ls `dirname $($LFS_TGT-gcc -print-libgcc-file-name)`/include-fixed
for file in $(find gcc/config -name linux64.h -o -name linux.h -o -name sysv4.h) ; do   cp -uv $file{,.orig};   sed -e 's@/lib\(64\)\?\(32\)\?/ld@/tools&@g'  -e 's@/usr@/tools@g' $file.orig > $file ; echo '
#undef STANDARD_STARTFILE_PREFIX_1
#undef STANDARD_STARTFILE_PREFIX_2
#define STANDARD_STARTFILE_PREFIX_1 "/tools/lib/" 
#define STANDARD_STARTFILE_PREFIX_2 ""' >> $file;  touch $file.orig; done
for file in $(find gcc/config -name linux64.h -o -name linux.h -o -name sysv4.h) ; do   cp -uv $file{,.orig};   sed -e 's@/lib\(64\)\?\(32\)\?/ld@/tools&@g'  -e 's@/usr@/tools@g' $file.orig > $file ; echo '
#undef STANDARD_STARTFILE_PREFIX_1
#undef STANDARD_STARTFILE_PREFIX_2
#define STANDARD_STARTFILE_PREFIX_1 "/tools/lib/" 
#define STANDARD_STARTFILE_PREFIX_2 ""' >> $file;  touch $file.orig; done
mkdir ../gcc-build
cd ../gcc-build
CC=$LFS_TGT=gcc \
CC=$LFS_TGT-gcc CXX=$LFS_TGT-g++ AR=$LFS_TGT-ar RANLIB=$LFS_TGT-ranlib ../gcc-4.9.2/configure --with-local-prefix=/tools --with-native-system-header-dir=/tools/include --enable-languages=c,c++ --disable-libstdcxx-pch --disable-multilib --disable-bootstrap --disable-libgomp 
make && make install 
CC=$LFS_TGT-gcc CXX=$LFS_TGT-g++ AR=$LFS_TGT-ar RANLIB=$LFS_TGT-ranlib ../gcc-4.9.2/configure --with-local-prefix=/tools --with-native-system-header-dir=/tools/include --enable-languages=c,c++ --disable-libstdcxx-pch --disable-multilib --disable-bootstrap --disable-libgomp --prefix=/tools&&make && make install
ln -sv gcc /tools/bin/cc
cc dummy.c 
readelf -l a.out |grep ': /tools'
tar -xf package/tcl8.6.3-src.tar.gz 
chmod -v u+2 /tools/lib/libtcl8.6.so 
make install-private-headers 
ln -sv tclsh8.6 /tools/bin/tclsh
tar -xf package/expect5.45.tar.gz 
cp -v configure{,.orig} 
sed 's:/usr/local/bin/:/bin:' configure.orig > configure
./configure --prefix=/tools --with-tcl=/tools/lib --with-tclinclude=/tools/include 
make SCRIPTS="" install 
tar -xf package/dejagnu-1.5.2.tar.gz 
make install 
make check
tar -xf package/check-0.9.14.tar.gz 
cd check-0.9.14/
PKG_CONFIG= ./configure --prefix=/tools
tar -xf package/ncurses-5.9.tar.gz 
cd ncurses-5.9/
./configure --prefix=/tools --with-shared --without-debug --without-ada --enable-widec --enable-overwrite
tar -xf package/bash-4.3.30.tar.gz 
cd bash-4.3.30/
./configure --prefix=/tools --without-bash-malloc
ln -sv bash /tools/bin/sh
tar -xf package/bzip2-1.0.6.tar.gz 
cd bzip2-1.0.6/
make PREFIX=/tools install 
tar -xf package/coreutils-8.23.tar.xz 
cd coreutils-8.23/
./configure --prefix=/tools --enable-install-program=hostname
tar -xf package/diffutils-3.3.tar.xz 
cd diffutils-3.3/
tar -xf package/file-5.22.tar.gz 
cd file-5.22/
tar -xf package/findutils-4.4.2.tar.gz 
cd  findutils-4.4.2/
tar -xf package/gawk-4.1.1.tar.xz 
cd gawk-4.1.1/
tar -xf package/gettext-0.19.4.tar.xz 
cd gettext-0.19.4/
cd gettext-tools/
EMACS="no" ./configure --prefix=/tools --disable-shared 
make -C gnulib-lib 
make -C intl pluralx.c 
make -C src msgfmt 
make -C src msgmerge 
make -C src xgettext
cp -v src/{msgfmt,msgmerge,xgettext} /tools/bin
tar -xf package/grep-2.21.tar.xz 
cd grep-2.21/
tar -xf package/gzip-1.6.tar.xz 
cd gzip-1.6/
tar -xf package/m4-1.4.17.tar.xz 
cd m4-1.4.17/
tar -xf package/make-4.1.tar.bz2 
cd make-4.1/
./configure --prefix=/tools --without-guile
tar -xf package/patch-2.7.4.tar.xz 
cd patch-2.7.4/
tar -xf package/perl-5.20.2.tar.bz2 
cd perl-5.20.2/
sh Configure -des -Dprefix=/tools -Dlibs=-lm
cp -v perl cpan/podlators/pod2man /tools/bin
mkdir -pv /tools/lib/perl5/5.20.2
cp -Rv lib/* /tools/lib/perl5/5.20.2
tar -xf package/sed-4.2.2.tar.bz2 
cd sed-4.2.2/
tar -xf package/tar-1.28.tar.xz 
cd tar-1.28/
tar -xf package/texinfo-5.2.tar.xz 
cd texinfo-5.2/
./configure --prefix=/tools
tar -xf package/util-linux-2.26.tar.xz 
cd util-linux-2.26/
./configure --prefix=/tools --without-python --disable-makeinstall-chown --without-systemdsystemunitdir PKG_CONFIG="" 
make 
make install
tar -xf package/xz-5.2.0.tar.xz 
cd xz-5.2.0/
./configure --prefix=/tools 
make && make install
rm -rf /tools/{,share}/{info,man,doc
rm -vrf /tools/{,share}/{info,man,doc}
